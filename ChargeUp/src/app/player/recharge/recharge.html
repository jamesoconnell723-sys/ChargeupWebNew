<div class="recharge-wrapper py-5">
  <div class="container">

    <!-- ===================== -->
    <!-- Recharge Section -->
    <!-- ===================== -->
    <div *ngIf="!showPaymentPage && !showPendingRechargePage"><!-- updated condition -->

      <!-- Recharge Header -->
      <div class="glass-card p-4 mb-4 portal-glass-card">
        <h4 class="section-title">Recharge Your Account</h4>

        <div class="d-flex align-items-center justify-content-between flex-wrap mt-3 gap-3">
          <!-- Selected Amount -->
          <div class="d-flex align-items-center gap-2 flex-wrap">
            <span class="selected-amount">
              <i class="fas fa-coins"></i> {{ selectedAmount }}
            </span>
            <input type="text" placeholder="Add Transaction Note" class="note-input" [(ngModel)]="transactionNote" />
          </div>

          <!-- Payment Type (Dropdown) -->
          <div class="payment-type">
            <select class="payment-select" [(ngModel)]="selectedPaymentType">
              <option *ngFor="let option of paymentTypes" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Recharge Options -->
      <div class="amount-options mb-3 text-center">
        <button *ngFor="let amount of rechargeOptions"
                class="amount-btn"
                [ngClass]="{'active': selectedAmount === amount}"
                (click)="selectOption(amount)">
          <i class="fas fa-coins"></i> {{ amount }}
        </button>
        <p class="mt-2 text-muted small">Recharge now and keep playing! üéâ</p>
      </div>

      <!-- Wallet Recharge Button (only if Wallet selected) -->
      <div class="text-center mb-4" *ngIf="selectedPaymentType === 'wallet'">
        <button class="recharge-btn wallet-btn"
                [disabled]="selectedAmount === 0"
                (click)="walletRecharge()">
          <i class="fas fa-wallet"></i> Wallet Recharge
        </button>
      </div>

      <!-- Payment Methods (Show only if "Payment Portal" selected) -->
      <div class="payment-methods mb-4" *ngIf="selectedPaymentType === 'portal'">
        <div class="method-card" *ngFor="let method of paymentMethods">
          <div class="method-left">
            <div class="method-icon" [ngStyle]="{'background': method.color}">
              <i [class]="method.icon"></i>
            </div>
            <div>
              <h6>{{ method.title }}</h6>
              <p class="small text-muted">{{ method.description }}</p>
            </div>
          </div>
          <div class="method-right d-flex align-items-center gap-2">
            <img *ngFor="let icon of method.icons" [src]="icon" alt="icon" />
            <!-- Pay Now Button for each card -->
            <button class="paynow-btn" (click)="redirectToPayment(method.title)">
              Pay Now
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Recharges -->
      <div class="recent-recharges glass-card p-4 mt-4">
        <!-- Total Transactions Card -->
        <div class="total-transactions d-flex justify-content-between align-items-center mb-3"
             (click)="goToPendingRecharge()" style="cursor:pointer;">
          <div class="d-flex align-items-center gap-2">
            <div class="transaction-icon"><i class="fas fa-file-alt"></i></div>
            <div>
              <div>Total number of transactions</div>
              <div class="transaction-count">{{ recentRecharges.length }}</div>
            </div>
          </div>
          <div class="arrow-icon"><i class="fas fa-chevron-right"></i></div>
        </div>

        <!-- Show last recharge -->
        <div *ngIf="recentRecharges.length > 0">
          <div class="pending-confirmation d-flex justify-content-between align-items-center mt-2">
            <div>Last Recharge</div>
            <div class="confirmation-amount">{{ recentRecharges[0].amount }}</div>
          </div>
          <div class="text-muted small">
            {{ recentRecharges[0].date | date:'d MMMM yyyy | h:mm:ss a' }}
          </div>
        </div>
      </div>
    </div><!-- /ngIf !showPaymentPage && !showPendingRechargePage -->

    <!-- ===================== -->
    <!-- Embedded Payment Section -->
    <!-- ===================== -->
    <div *ngIf="showPaymentPage" class="payment-screen glass-card p-4 portal-glass-card">

      <!-- Back button -->
      <button class="btn btn-secondary mb-3" (click)="goBack()">
        <i class="fas fa-arrow-left"></i> Back
      </button>

      <!-- Payment Title -->
      <h4 class="section-title mb-3">{{ selectedMethod }}</h4>
      <p class="text-muted">You‚Äôre about to pay <strong>${{ selectedAmount }}</strong></p>

      <!-- Payment Form (example Stripe-style layout) -->
      <form (ngSubmit)="completePayment()" class="payment-form">
        <div class="mb-3">
          <label class="form-label">Card Number</label>
          <input type="text" class="form-control" placeholder="1234 5678 9012 3456" required>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Expiry Date</label>
            <input type="text" class="form-control" placeholder="MM/YY" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">CVV</label>
            <input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary w-100">
          Pay Now ${{ selectedAmount }}
        </button>
      </form>
    </div><!-- /Payment Section -->

    <!-- ===================== -->
    <!-- Pending Recharge Page -->
    <!-- ===================== -->
    <div *ngIf="showPendingRechargePage" class="pending-wrapper py-4">
      <div class="container">

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
          <button class="btn btn-light back-btn" (click)="backFromPendingRecharge()">
            ‚Üê BACK
          </button>
          <h4 class="mb-0">Pending Recharge Request</h4>
          <div class="d-flex align-items-center gap-2">
            <button class="btn btn-outline-secondary" (click)="openFilterModal()">
              <i class="fas fa-filter"></i> Filter
            </button>
            <button class="btn btn-outline-primary">
              Refresh
            </button>
          </div>
        </div>

        <!-- Table -->
        <div class="table-responsive glass-card">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Action</th>
                <th>Account</th>
                <th>Recharged</th>
                <th>Status</th>
                <th>Failed Reason</th>
                <th>Recharge Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of [1,2,3,4,5,6,7,8,9]">
                <td><button class="expire-btn">EXPIRE</button></td>
                <td>ravi</td>
                <td>50</td>
                <td><span class="expired-status">Expired</span></td>
                <td>-</td>
                <td>9/24/2025, 9:13:18 PM</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Filter Modal -->
      <div class="filter-modal" *ngIf="showFilterModal">
        <div class="filter-overlay" (click)="closeFilterModal()"></div>
        <div class="filter-content">
          <h5>Filter Options</h5>
          <select [(ngModel)]="selectedFilter">
            <option value="">Search By</option>
            <option value="recharge">Recharge Filter</option>
            <option value="remark">Remark Filter</option>
          </select>
          <div class="mt-3 d-flex gap-2">
            <button class="btn btn-dark w-50" (click)="applyFilter()">APPLY</button>
            <button class="btn btn-outline-dark w-50" (click)="closeFilterModal()">CANCEL</button>
          </div>
        </div>
      </div>
    </div><!-- /Pending Recharge Page -->

  </div>
</div>
